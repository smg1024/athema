<style>
body {
	color: black;
	
}

.contact_form_container {
	padding: 30px;
	margin-bottom: 60px;
	justify-content: center;
}
.qna_header {
	padding: 20px;
}
.qna_header .qna_info {
	display: flex;
	flex-direction: column;
}
.qna_info{
	margin: 10px 0;
}
.faq_title {
	font-size: 30px;
	font-weight: bold;
}
.qna_category {
	margin-bottom: 10px;
}
.qna_category:hover {
	text-decoration: none;
}
#todiv::-webkit-scrollbar {
	display: none;
}
#totext::-webkit-scrollbar {
	display: none;
}

#to {
	width: 600px;
	height: 500px;
	border: 3px solid lightgray;
	border-radius: 30px;
	margin: 20px 0;
	display: flex;
	justify-content: center;
	align-items: center;
	background-color: #dde6ee;
}
#todiv {
	overflow: scroll;
	flex-direction: column;
	justify-content: space-between;
	width: 520px;
	height: 420px;
}
.input_send{
	display: flex;
	width: 600px;
}
#totext {
	flex: 7;
	margin-left: 3px;
	padding: 13px;
	border-radius: 10px 0 0 10px;
	border: 3px solid lightgray;
	border-right: none;
	background-color: #fff;
	align-self: center;
	white-space: nowrap;
	color: black;
	overflow: scroll;
}
#tocode{
	flex: 1;
	padding: 13px 17px;
	border-radius: 10px;
	text-align: center;
	margin-left: 3px;
	margin-right:5px;
	border: 3px solid lightgray;
	background-color: #fff;
	white-space: nowrap;
	color: black;
	overflow: hidden;
}
#totext:focus
{
	border: 3px solid lightgray;
	border-right: none;
	outline: none;
}
#sendto {
	flex: 1;
	border-radius: 0 10px 10px 0;
	font-size:1.7em;
	cursor: pointer;
	display: flex;
	justify-content: center;
	align-items: center;
	border: 3px solid lightgray;
	border-left: none;
	background-color: #fff;
	margin-right: 5px;
}
	
#sendto:focus
{
	border: 3px solid lightgray;
	border-left: none;
	outline: none;
}
#disconnect
{
	color: #fff;
	background-color: #002080;
	padding: 5px 10px;
	border-radius: 10px;
	border: none;
	cursor: pointer;
}
.appendli {
	margin-bottom: 15px;
	padding: 7px 13px;
	color: #674188;
	border-radius: 10px;
}
.appendli2 {
	margin-bottom: 15px;
	padding: 7px 13px;
	color: #674188;
	border-radius: 10px;
}
.appenddis {
	margin-bottom: 15px;
	padding: 7px 13px;
	color: #21516C;
	border-radius: 10px;
}
.reid {
	float: left;
	clear: both;
	align-items: right;
	color: #6096B4;
	margin-bottom:5px;
}
#append_cust {
	background-color : #93BFCF;
	color: black;
	max-width: 55%;
	text-align: left;
	float: left;
	clear: both;
}
#appendto{
	float: right;
	clear: both;
	background-color: #6096B4;
	color: white;
 	max-width: 55%;
	align-items: right;
}
#discon_chat {
	float: left;
	clear: both;
}
#status {
	color: #748DA6;
	font-weight: bold;
 	background-color: #F5EBE0;
	padding: 10px 20px;
	border: 2px dashed #748DA6;
 	margin-bottom: 15px; 
 	border-radius: 20px; 
 	float: left;
 	clear: left;
}
</style>
<script>
var stompClient = null;
var id = 'admin';

$(document).ready(function() {
	// localì—ì„œ ì‚¬ìš© ì‹œ 127~:8080/adminìœ¼ë¡œ ì£¼ì†Œ ìˆ˜ì •í•  ê²ƒ
	var socket = new SockJS('http://49.50.166.168/admin/ws');
	stompClient = Stomp.over(socket);

	stompClient.connect({}, function(frame) { 
		setConnected(true);
		console.log('Connected: ' + frame);
		stompClient.subscribe('/send/to/'+id, function(msg) { 
			$("#todiv").append(
					"<div class='reid'>" + JSON.parse(msg.body).sendid +"ë²ˆ ì‚¬ìš©ì </div>");		// sendid ë½‘ì•„ë‚´ê¸°
			$("#todiv").append(		// ê³ ê°ì´ ë³´ë‚¸ ë©”ì‹œì§€ (ì™¼ìª½ float)
					"<div class='appendli2' id='append_cust'>" + JSON.parse(msg.body).content1 +"</div>");

			let chat = document.querySelector("#todiv");	// ìŠ¤í¬ë¡¤ ìë™ ë‚´ë¦¬ê¸°
			chat.scrollTop = chat.scrollHeight;
		});
	});
	
	$("#disconnect").click(function() {
		disconnect();
	});
	$("#sendto").click(function() {
		sendTo();
	});
});

// ì—”í„°í‚¤ ëˆŒë ¸ì„ ë•Œ send
function enterkey() {
    if (window.event.keyCode == 13) {
		sendTo();    	
    }
}

// ì„œë²„ì†Œì¼“ì— ì—°ê²°ëŠê¸°
function disconnect() {
	if (stompClient !== null) {
		stompClient.disconnect();
	}
	setConnected(false);
	console.log("Disconnected");
}

// connect & disconnect ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
function setConnected(connected) {
	if (connected) {
		$("#status").text("ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");
	} else {
		$("#todiv").append(
		"<div class='appenddis' id='discon_chat'>ì±„íŒ…ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</br>ì±„íŒ…ì„ ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</div>");
		$("#status").text("Disconnected");
		
	}
}

// ì„œë²„ì— ë©”ì„¸ì§€ ìš”ì²­ ë©”ì„œë“œ
function sendTo() {
	var msg = JSON.stringify({
		'sendid' : id,
		'receiveid' : $('#tocode').text(),
		'content1' : $('#totext').text()
	});
	
	// ê³µë°± ì•„ë‹ ë•Œë§Œ ë³´ë‚´ê³  ì…ë ¥ì°½ ë¹„ìš°ê¸°
	if($("#totext").text() != "") {
		stompClient.send('/receiveto', {}, msg);
	}
		$("#totext").text('');
	
	// div ì±„íŒ…ì°½ì— ë„ìš°ê¸°
	var msgc = JSON.parse(msg)	// ë¬¸ìì—´ ì²˜ë¦¬ëœ json parseí•´ì„œ
	if (msgc.content1 == "") {	// ê³µë°± false ì²˜ë¦¬
		return false;
	}
	$("#todiv").append(
		"<div class='appendli' id='appendto'>" + msgc.content1 + "</div>");		// content1 ë½‘ì•„ë‚´ê¸°
	
	// ì±„íŒ…ë°© ìŠ¤í¬ë¡¤ ìë™ìœ¼ë¡œ ë‚´ë¦¬ê¸° (ì‚¬ìš©ì -> ê´€ë¦¬ì)
	let chat = document.querySelector('#todiv');
    chat.scrollTop = chat.scrollHeight;
	
}
</script>

	<!-- Contact Form -->
	<div class="contact_form_container" id="faq_container">
		<div class="qna_header">
			<div class="faq_title">1:1 ì‹¤ì‹œê°„ ìƒë‹´ ë¬¸ì˜</div>
			<div class="qna_info">
				<a class="qna_category">ğŸ‘‰ ìš´ì˜ì‹œê°„ : í‰ì¼ 10ì‹œ ~ 17ì‹œ </a>
				<a class="qna_category">ğŸ‘‰ í˜ì´ì§€ ë°©ë¬¸ ì‹œ ìë™ìœ¼ë¡œ connectë¡œ ì „í™˜</a>
				<a class="qna_category">ğŸ‘‰ disconnect ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•¨</a>
			</div>
		</div>
		<div class="msg-container">
			<div class="col-sm-5">
				<button id="disconnect" type="button">disconnect</button>
				<!-- To-chat -->
				<div id="to">
					<div id="todiv">
						<div id="status"></div>
					</div>
				</div>
				<div class="input_send">
					<div id="tocode" class="target" contenteditable="true" disabled="true" autofocus></div>
					<div id="totext" class="text-box" contenteditable="true" disabled="true" onkeyup="enterkey()"></div>
					<button id="sendto" type="button"><img th:src="@{/img/paper-plane-icon.png}" style="width:40%;"></button>
				</div>
			</div>
		</div>				
	</div>
	
<!-- <div class="container"> -->
<!-- 	<H1>1:1 ì‹¤ì‹œê°„ ìƒë‹´ ë¬¸ì˜</H1> -->
<!-- 	<h5>í‰ì¼ ì˜¤ì „ 10ì‹œë¶€í„° ì˜¤í›„ 5ì‹œê¹Œì§€ ìš´ì˜</h5> -->
<!-- 	<div class="col-sm-5"> -->
<!-- 	<H1 id="status">ì—°ê²° ì „</H1> -->
<!-- 	<button id="connect">Connect</button> -->
<!-- 	<button id="disconnect">Disconnect</button> -->
	
<!-- 	<h3>To</h3> -->
<!-- 	<input type="text" id="target">ë²ˆ íšŒì›ì—ê²Œ -->
<!-- 	<input type="text" id="totext"><button id="sendto">ì „ì†¡í•˜ê¸°</button> -->
<!-- 	<div id="to"></div> -->

<!-- 	</div> -->
<!-- </div> -->