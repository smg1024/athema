<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<!-- CONTACT -->
<link rel="stylesheet" type="text/css" th:href="@{/styles/contact_styles.css}">
<link rel="stylesheet" type="text/css" th:href="@{/styles/contact_responsive.css}">
<link rel="stylesheet" type="text/css" th:href="@{/styles/headfoot_styles.css}">
<link rel="stylesheet" type="text/css" th:href="@{/styles/headfoot_responsive.css}">

<style>
.contact_form_container {
	display: flex;
	justify-content: center;
}
.contact_form_inner {
	margin: 30px 0 30px 0;
}
#todiv::-webkit-scrollbar {
	display: none;
}
#totext::-webkit-scrollbar {
	display: none;
}

#to {
	width: 600px;
	height: 500px;
	border-radius: 30px;
	margin: 20px 0;
	display: flex;
	justify-content: center;
	align-items: center;
	background-color: #FFFBF5;
}
#todiv {
	overflow: scroll;
	flex-direction: column;
	justify-content: space-between;
	width: 520px;
	height: 420px;
}
.input_send{
	display: flex;
	width: 600px;
}
#totext {
	flex: 9;
	margin-left: 3px;
	padding: 13px 17px;
	border-radius: 10px 0 0 10px;
	border: none;
	background-color: #F7EFE5;
	align-self: center;
	white-space: nowrap;
	color: black;
	overflow: scroll;
}
#totext:focus
{
	border: none;
	outline: none;
}
#sendto {
	flex: 1;
	padding: 3px 7px;
	border-radius: 0 10px 10px 0;
	border: none;
	font-size:1.7em;
	cursor: pointer;
	display: flex;
	justify-content: center;
	align-items: center;
	background-color: #F7EFE5;
	}
#sendto:focus
{
	border: none;
	outline: none;
}
#disconnect
{
	color: #044D49;
	padding: 3px 7px;
	border-radius: 10px;
	border: none;
	cursor: pointer;
}
.appendli {
	margin: 30px 0 20px 0;
	padding: 7px 13px;
	color: #674188;
	border-radius: 10px;
	margin: 10px 0;
}
#appendsendid {
	background-color : #674188;
	color: white;
	max-width: 55%;
	text-align: left;
	float: left;
	clear: both;
}
#appendto{
	float: right;
	clear: both;
	background-color: #E8D9F0;
	color: black;
 	max-width: 55%;
	align-items: right;
}
#discon_chat {
	float: left;
	clear: both;
}
#status {
	color: black;
	font-weight: bold;
	background-color: #F7EFE5;
	padding: 20px 20px;
 	margin-bottom: 15px; 
 	border-radius: 10px; 
	text-align: center;
}
</style>

<!-- Home -->

<div class="home">
	<div class="home_background parallax-window" data-parallax="scroll" th:data-image-src="@{/images/contact_background.jpg}"></div>
	<div class="home_content">
		<div class="home_title">QnA Center</div>
	</div>
</div>

<!-- Contact -->

<div class="contact_form_section">
	<div>
		<div class="container">
			<div class="row" style="margin:auto; width: 80%;">
				<div class="col">
					<!-- Contact Form -->
					<div class="contact_form_container" id="faq_container">
						<div class="contact_form_inner">
							<div class="qna_header">
								<div class="faq_title">1:1 ì±„íŒ…ë¬¸ì˜<span style="font-size: 0.5em; font-weight: normal;">&nbsp;&nbsp;ìš´ì˜ìì™€ì˜ ì±„íŒ…ì€ í‰ì¼ 10:00 - 17:00 ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</span></div>
								<div class="qna_info">
									<a th:href="@{/contact}" class="qna_category">ğŸ‘‰ ì±„íŒ…ì„ ë‚¨ê¸°ê¸° ì „ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</a>
									<a href="#" class="qna_category">ğŸ‘‰ ìš°ì¸¡ í•˜ë‹¨ì˜ ì±—ë´‡ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì…”ë„ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</a>
								</div>
							</div>
							<div class="msg-container">
								<div class="col-sm-5">
									<button id="disconnect" type="button">ì±„íŒ… ëë‚´ê¸°</button>
									<!-- To-chat -->
									<input type="text" id="target" value="admin" hidden>
									<div id="to">
										<div id="todiv">
											<div id="status"></div>
										</div>
									</div>
									<div class="input_send">
										<div id="totext" class="text-box" contenteditable="true" disabled="true" onkeyup="enterkey()" autofocus></div>
										<button id="sendto" type="button"><img th:src="@{/images/paper-plane-icon.png}" style="width:40%;"></button>
									</div>
								</div>
							</div>
						</div>				
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
						
<script th:inline="javascript">

var stompClient = null;
var id = '[[${session.loginMember.mem_code}]]';

$(document).ready(function() {
	var socket = new SockJS('http://127.0.0.1:8080/admin/ws');
	stompClient = Stomp.over(socket);

	stompClient.connect({}, function(frame) { 
		setConnected(true);
		console.log('Connected: ' + frame);

		stompClient.subscribe('/send/to/'+id, function(msg) { 
			$("#todiv").append(
					"<div class='appendli' id='appendsendid'>" + JSON.parse(msg.body).content1 + "</div><br/>");

			// ì±„íŒ…ë°© ìŠ¤í¬ë¡¤ ìë™ìœ¼ë¡œ ë‚´ë¦¬ê¸° (ê´€ë¦¬ì -> ì‚¬ìš©ì)
			let chat = document.querySelector('#todiv');
	        chat.scrollTop = chat.scrollHeight;
		});
	});
	
// 	$("#connect").click(function() {
// 		connect();
// 	});
	$("#disconnect").click(function() {
		disconnect();
	});
	$("#sendto").click(function() {
		sendTo();
	});
});

	// ì„œë²„ì†Œì¼“ì— ì—°ê²°
// 	function connect() {
// 		var socket = new SockJS('http://127.0.0.1:8080/admin/ws');
// 		stompClient = Stomp.over(socket);
	
// 		stompClient.connect({}, function(frame) { 
// 			setConnected(true);
// 			console.log('Connected: ' + frame);
	
// 			stompClient.subscribe('/send/to/'+id, function(msg) { 
// 				$("#to").prepend(
// 						"<h4>" + JSON.parse(msg.body).sendid +":"+
// 						JSON.parse(msg.body).content1
// 								+ "</h4>");
// 			});
// 		});
// 	}
	
	// ì„œë²„ì†Œì¼“ì— ì—°ê²°ëŠê¸°
	function disconnect() {
		if (stompClient != null) {
			stompClient.disconnect();
		}
		setConnected(false);
		console.log("Disconnected");
	}
	
	// connect&disconnect ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
	function setConnected(connected) {
		if (connected) {
			$("#status").text("ì±„íŒ…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
		} else {
			$("#todiv").append(
					"<div class='appendli' id='discon_chat'>ì±„íŒ…ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</br>ì±„íŒ…ì„ ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</div>");
			$("#status").text("disconnected");
		}
	}
    
	// ì—”í„°í‚¤ ëˆŒë ¸ì„ ë•Œ send
	function enterkey() {
	    if (window.event.keyCode == 13) {
			sendTo();    	
	    }
	}
	
	// ì„œë²„ì— ë©”ì„¸ì§€ ìš”ì²­
	function sendTo() {
		var msg = JSON.stringify({
			'sendid' : id,
			'receiveid' : $('#target').val(),
			'content1' : $('#totext').text()
		});
		// ê³µë°± ì•„ë‹ ë•Œë§Œ ë³´ë‚´ê³  ì…ë ¥ì°½ ë¹„ìš°ê¸°
		if($("#totext").text() != "") {
			stompClient.send('/receiveto', {}, msg);
		}
			$("#totext").text('');
		// div ì±„íŒ…ì°½ì— ë„ìš°ê¸°
		var msgc = JSON.parse(msg)	// ë¬¸ìì—´ ì²˜ë¦¬ëœ json parseí•´ì„œ
		if (msgc.content1 == "") {	// ê³µë°± false ì²˜ë¦¬
			return false;
		}
		$("#todiv").append(
			"<div class='appendli' id='appendto'>" + msgc.content1 + "</div>");		// content1(key)ë§Œ ë½‘ì•„ë‚´ê¸°
		
		// ì±„íŒ…ë°© ìŠ¤í¬ë¡¤ ìë™ìœ¼ë¡œ ë‚´ë¦¬ê¸° (ì‚¬ìš©ì -> ê´€ë¦¬ì)
		let chat = document.querySelector('#todiv');
        chat.scrollTop = chat.scrollHeight;
	}
</script>
